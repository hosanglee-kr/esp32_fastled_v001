
ESP32와 MPU6050, LED Matrix를 활용하여 
자동차의 움직임에 따라 
로봇 눈의 표정을 LED Matrix로 표현하는 장치를 
자동차 후방에 설치하는 프로젝트입니다.

# 프로젝트 개요
ESP32와 MPU6050을 사용하여 
자동차의 다양한 움직임(속도, 가속/감속, 경사, 회전 등)을 감지하고, 
이 정보를 기반으로 LED Matrix에 
로봇 눈의 표정을 표현하는 장치입니다. 
이 장치는 자동차 후방에 설치됩니다.

# 세부 요구사항
1. MPU6050 설정 및 데이터 처리
 * MPU6050 설치 방향: MPU6050은 전방(자동차 진행 방향)을 Y축, 위쪽을 Z축으로 하여 설치됩니다.
 * DMP (Digital Motion Processor) 사용: MPU6050의 DMP 기능을 활용하여 데이터 처리의 효율성과 정확성을 높입니다.
 * SW 필터 적용: 자동차의 진동에 대응할 수 있는 적절한 소프트웨어 필터를 적용하여 MPU6050 데이터의 안정성을 확보합니다.
2. 자동차 움직임 감지 및 상태 정의
다음과 같은 자동차의 개략적인 움직임을 감지하고 상태를 정의해야 합니다.
 *  
3. 자동차 상태 정보 출력
 * 시리얼 출력: 5초 간격으로 현재 자동차의 상태 정보를 시리얼 모니터로 출력합니다.
4. 자동차 상태 정의 구조체
 * 구조체 정의: 위에서 요구된 자동차의 상태 정보를 종합하여 하나의 구조체로 정의하고, 이 구조체를 소스 코드에 반영해야 합니다.
5. 소스 코드 요구사항
 * 전체 소스 코드: 요구사항을 모두 반영한 전체 소스 코드를 제공해야 합니다.
 * 주석: 소스 코드 앞 부분에 요구 기능에 대한 주석을 추가하고, 코드 내에 상세 설명을 위한 주석을 충분히 포함해야 합니다.
 * 명명 규칙:
   * 전역 상수: G_M010_으로 시작
   * 전역 변수: g_M010_으로 시작
   * 로컬 변수: v_로 시작
   * 함수: M010_으로 시작
개발 환경 및 라이브러리
 * MCU: ESP32
 * IMU 센서: MPU6050
 * 개발 환경: PlatformIO Arduino Core
이 요구사항들을 바탕으로 소스 코드를 작성해 드리겠습니다.




# 자동차 상태 정의

* 전진, 후진, 정차, 주차
** 신호대기 1 : 60초 미만 정차
** 신호대기 2 : 120초 미만 정차(60초 이상)
** 정차 1 : 5분 미만 (120초 이싱)
** 정차 2 : 10분 미만 (5분 이싱)
** 주차 : 10분 이상( 10분 이상)
  
* +-이동 속도(Km/h), 가속도(m/s^2)
  
* 좌, 우회전 각도 (도)
* 전후 경사도(도) (평지, 오르막, 내리막)
* 급감속 상태
* 과속 방지턱 통과 여부

자동차 움직임 관련 구조체

// 정차와 주차를 구분하는 시간 기준 (초)
// 이 값보다 오랫동안 움직임이 감지되지 않으면 '주차' 상태로 간주합니다.
const unsigned long G_M010_PARK_THRESHOLD_SECONDS = 60; // 예시: 60초 이상 움직임 없으면 주차

// 자동차의 현재 움직임 상태를 정의하는 열거형 (enum)
// 이 상태들은 상호 배타적이며, 현재 차량이 어떤 움직임을 하고 있는지 나타냅니다.
enum CarMovementState {
    G_M010_STATE_UNKNOWN,   // 0: 초기 상태 또는 현재 상태를 알 수 없는 경우
    G_M010_STATE_STOPPED,   // 1: 정차 중 (속도가 0이지만 언제든 다시 움직일 수 있는 상태)
    G_M010_STATE_PARKED,    // 2: 주차 중 (일정 시간 이상 움직임이 없는 상태로, 장기 정지)
    G_M010_STATE_FORWARD,   // 3: 전진 중
    G_M010_STATE_REVERSE    // 4: 후진 중
};

// ---

// 자동차의 현재 상태 정보를 담는 구조체 (struct)
// 이 구조체의 각 멤버는 MPU6050 센서 데이터 분석을 통해 얻어진 자동차의 다양한 움직임 특성을 나타냄

struct M010_CarStatus {
    // 1. 자동차 움직임 상태 관련

    // 현재 자동차의 움직임 상태 (G_M010_STATE_UNKNOWN, _STOPPED, _PARKED, _FORWARD, _REVERSE 중 하나)
    CarMovementState v_currentMovementState;

    // 2. 속도 및 가속도 관련

    // 현재 자동차의 속도 (km/h 단위)
    // 양수(+)는 전진, 음수(-)는 후진
    float v_currentSpeed_kmh;

    // 자동차의 전후(Y축) 방향 가속도(m/s^2 단위)
    // MPU6050이 전방 Y축으로 설치, 
    // 이 값은 자동차의 가속/감속 정도
    // 양수: 가속, 음수: 감속 (전진 기준)
    float v_accelerationY_ms2;

    // 자동차의 상하(Z축) 방향 가속도(m/s^2 단위)
    // MPU6050이 위쪽 Z축으로 설치되었기 때문에,
    // 노면 충격(예:과속 방지턱) 감지에 사용
    // 급격한 변화는 충격을 의미
    float v_accelerationZ_ms2;

    // 3. 회전 관련
    // 현재 자동차의 Yaw 각도를 도(degree) 단위로 나타냄
    // Yaw 각은 수평면 상에서 차량이 향하고 있는 절대적인 방향(예: 북쪽 기준)을 나타냄
    // 범위는 보통 0 ~ 360 또는 -180 ~ 180도로 표현됨
    float v_currentYawAngle_deg;

    // 현재 자동차의 Yaw 각속도를 도/초(degree/second) 단위로 나타냄
    // 이는 자동차가 초당 몇 도씩 회전하고 있는지를 나타내며, 좌회전/우회전의 정도를 파악하는 데 사용됨

    // 일반적으로 양수는 한쪽 우회전), 
음수는 좌회전을 의미
    float v_yawRate_degps;

  
    // 4. 경사도 관련
    // 현재 자동차의 Pitch 각도를 도(degree) 단위로 나타냄
    // Pitch 각은 자동차의 전후 기울기(오르막/내리막 경사도)를 나타냄
    // 양수: 오르막, 음수: 내리막 
    float v_pitchAngle_deg;

    // 5. 특이 상황 관련

    // 과속 방지턱 통과 감지 여부를 나타냅니다.
    // true: 과속 방지턱 통과가 감지되었음을 의미합니다.
    // false: 현재 과속 방지턱을 통과하고 있지 않음을 의미합니다. (감지 후 일정 시간 뒤 false로 리셋)
    bool v_speedBumpDetected;
};

// ---

// 전역 변수로 자동차 상태 구조체 선언
// 이 변수에 MPU6050 데이터를 기반으로 분석된 자동차의 현재 상태 정보가 저장됩니다.
M010_CarStatus g_M010_carStatus;

